<html lang="en">

<head>
    <!-- <script type="text/javascript">
            +function(a,p,P,b,y){a.appboy={};a.appboyQueue=[];for(var s="DeviceProperties Card Card.prototype.dismissCard Card.prototype.removeAllSubscriptions Card.prototype.removeSubscription Card.prototype.subscribeToClickedEvent Card.prototype.subscribeToDismissedEvent Banner CaptionedImage ClassicCard ControlCard ContentCards ContentCards.prototype.getUnviewedCardCount Feed Feed.prototype.getUnreadCardCount ControlMessage InAppMessage InAppMessage.SlideFrom InAppMessage.ClickAction InAppMessage.DismissType InAppMessage.OpenTarget InAppMessage.ImageStyle InAppMessage.Orientation InAppMessage.TextAlignment InAppMessage.CropType InAppMessage.prototype.closeMessage InAppMessage.prototype.removeAllSubscriptions InAppMessage.prototype.removeSubscription InAppMessage.prototype.subscribeToClickedEvent InAppMessage.prototype.subscribeToDismissedEvent FullScreenMessage ModalMessage HtmlMessage SlideUpMessage User User.Genders User.NotificationSubscriptionTypes User.prototype.addAlias User.prototype.addToCustomAttributeArray User.prototype.getUserId User.prototype.incrementCustomUserAttribute User.prototype.removeFromCustomAttributeArray User.prototype.setAvatarImageUrl User.prototype.setCountry User.prototype.setCustomLocationAttribute User.prototype.setCustomUserAttribute User.prototype.setDateOfBirth User.prototype.setEmail User.prototype.setEmailNotificationSubscriptionType User.prototype.setFirstName User.prototype.setGender User.prototype.setHomeCity User.prototype.setLanguage User.prototype.setLastKnownLocation User.prototype.setLastName User.prototype.setPhoneNumber User.prototype.setPushNotificationSubscriptionType InAppMessageButton InAppMessageButton.prototype.removeAllSubscriptions InAppMessageButton.prototype.removeSubscription InAppMessageButton.prototype.subscribeToClickedEvent display display.automaticallyShowNewInAppMessages display.destroyFeed display.hideContentCards display.showContentCards display.showFeed display.showInAppMessage display.toggleContentCards display.toggleFeed changeUser destroy getDeviceId initialize isPushBlocked isPushGranted isPushPermissionGranted isPushSupported logCardClick logCardDismissal logCardImpressions logContentCardsDisplayed logCustomEvent logFeedDisplayed logInAppMessageButtonClick logInAppMessageClick logInAppMessageHtmlClick logInAppMessageImpression logPurchase openSession registerAppboyPushMessages removeAllSubscriptions removeSubscription requestContentCardsRefresh requestFeedRefresh requestImmediateDataFlush resumeWebTracking setLogger stopWebTracking subscribeToContentCardsUpdates subscribeToFeedUpdates subscribeToInAppMessage subscribeToNewInAppMessages toggleAppboyLogging trackLocation unregisterAppboyPushMessages wipeData".split(" "),i=0;i<s.length;i++){for(var m=s[i],k=a.appboy,l=m.split("."),j=0;j<l.length-1;j++)k=k[l[j]];k[l[j]]=(new Function("return function "+m.replace(/\./g,"_")+"(){window.appboyQueue.push(arguments); return true}"))()}window.appboy.getCachedContentCards=function(){return new window.appboy.ContentCards};window.appboy.getCachedFeed=function(){return new window.appboy.Feed};window.appboy.getUser=function(){return new window.appboy.User};(y=p.createElement(P)).type='text/javascript';
              y.src='https://js.appboycdn.com/web-sdk/3.2/appboy.min.js';
              y.async=1;(b=p.getElementsByTagName(P)[0]).parentNode.insertBefore(y,b)
            }(window,document,'script');
          </script> -->
    <!-- Global site tag (gtag.js) - Google Ads: 375902446 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-375902446"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'AW-375902446');
    </script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6CD87GVTZP"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-6CD87GVTZP');
    </script>
    <script type="text/javascript"
        src="https://js.taplytics.com/jssdk/1c939ef77a614360b10b65a049e8ebea.min.js"></script>
    <script src="//assets.adobedtm.com/82cfae7baf21/8c89b5f88442/launch-cc04b6cf1a79-development.min.js" async></script>
    <!-- <script type="text/javascript">
            window.DY = window.DY || {}; 
            DY.recommendationContext = { type: "PRODUCT", data: ['SKU123'] }; // in this example - a product page 
          </script> -->
    <script>
        !function (f, b, e, v, n, t, s) {
            if (f.fbq) return; n = f.fbq = function () {
                n.callMethod ?
                    n.callMethod.apply(n, arguments) : n.queue.push(arguments)
            };
            if (!f._fbq) f._fbq = n; n.push = n; n.loaded = !0; n.version = '2.0';
            n.queue = []; t = b.createElement(e); t.async = !0;
            t.src = v; s = b.getElementsByTagName(e)[0];
            s.parentNode.insertBefore(t, s)
        }(window, document, 'script',
            'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '{your-pixel-id-goes-here}');
        fbq('track', 'PageView');
    </script>
    <noscript>
        <img height="1" width="1" style="display:none"
            src="https://www.facebook.com/tr?id={your-pixel-id-goes-here}&ev=PageView&noscript=1" />
    </noscript>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script type="text/javascript">
        let couch1;
        let laserProjector1;
        let lightTable1;

        window.mParticle = {
            config: {
                isDevelopmentMode: true,
                // useCookieStorage: true,
                logLevel: "verbose",
            
                // dataPlan: {
                //     planId: '7347_allow_null'
                // }     
                // sessionTimeout: 0
                // identifyRequest: {
                //     email: 'sample@example.com', 
                //     custmerid: '12345'
                // }
                v1SecureServiceUrl: "jssdks-qa1.qa.corp.mparticle.com/v1/JS/",
                v2SecureServiceUrl: "jssdks-qa1.qa.corp.mparticle.com/v2/JS/",
                v3SecureServiceUrl: "jssdks-qa1.qa.corp.mparticle.com/v3/JS/",
                configUrl: "jssdks-qa1.qa.corp.mparticle.com/js/v2/",
                identityUrl: "identity-qa1.qa.corp.mparticle.com/v1/",
                forceHttps: false,
            }, 
        };

        (
            function (t) { 
                window.mParticle = window.mParticle || {};
        window.mParticle.EventType = {
          Unknown: 0,
          Navigation: 1,
          Location: 2,
          Search: 3,
          Transaction: 4,
          UserContent: 5,
          UserPreference: 6,
          Social: 7,
          Other: 8,
        };
        window.mParticle.eCommerce = { Cart: {} };
        window.mParticle.Identity = {};
        window.mParticle.config = window.mParticle.config || {};
        window.mParticle.config.rq = [];
        window.mParticle.config.snippetVersion = 2.3;
        window.mParticle.ready = function (t) {
          window.mParticle.config.rq.push(t);
        };
        var e = [
          "endSession",
          "logError",
          "logBaseEvent",
          "logEvent",
          "logForm",
          "logLink",
          "logPageView",
          "setSessionAttribute",
          "setAppName",
          "setAppVersion",
          "setOptOut",
          "setPosition",
          "startNewSession",
          "startTrackingLocation",
          "stopTrackingLocation",
        ];
        var o = ["setCurrencyCode", "logCheckout"];
        var i = ["identify", "login", "logout", "modify"];
        e.forEach(function (t) {
          window.mParticle[t] = n(t);
        });
        o.forEach(function (t) {
          window.mParticle.eCommerce[t] = n(t, "eCommerce");
        });
        i.forEach(function (t) {
          window.mParticle.Identity[t] = n(t, "Identity");
        });
        function n(e, o) {
          return function () {
            if (o) {
              e = o + "." + e;
            }
            var t = Array.prototype.slice.call(arguments);
            t.unshift(e);
            window.mParticle.config.rq.push(t);
          };
        }
        var dpId,
          dpV,
          config = window.mParticle.config,
          env = config.isDevelopmentMode ? 1 : 0,
          dbUrl = "?env=" + env,
          dataPlan = window.mParticle.config.dataPlan;
        dataPlan &&
          ((dpId = dataPlan.planId),
          (dpV = dataPlan.planVersion),
          dpId &&
            (dpV && (dpV < 1 || dpV > 1e3) && (dpV = null),
            (dbUrl +=
              "&plan_id=" + dpId + (dpV ? "&plan_version=" + dpV : ""))));
        var mp = document.createElement("script");
        mp.type = "text/javascript";
        mp.async = true;
        mp.src =
          ("https:" == document.location.protocol
            ? "https://jssdk-origin-qa1.qa.corp"
            : "https://jssdk-origin-qa1.qa.corp") +
          ".mparticle.com/js/v2/" +
          t +
          "/mparticle.js" +
          dbUrl;
        var c = document.getElementsByTagName("script")[0];
        c.parentNode.insertBefore(mp, c);
    })("us1qa-de572e9f3e5ca64da6b5beaad2e5e3df");

        window.mParticle.ready(
            function () {
                console.log('mParticle has loaded!');
                // const user = mParticle.Identity.getCurrentUser(); 
                // const login = document.querySelector('.login_screen'); 
                // const main = document.querySelector('.main_screen'); 


                // if (user.isLoggedIn()){
                //     login.style.display = 'none'; 
                //     main.style.display = 'block'; 
                // } else {
                //     login.style.display = 'block'; 
                //     main.style.display = 'none'; 
                // }

                couch1 = mParticle.eCommerce.createProduct(
                    'test couch - 6326',
                    'SC-1',
                    8999.99,
                    1,
                    '',
                    '',
                    'West Elm',
                    '',
                    '',
                    { "7156_PCA2": "test" }
                )

                laserProjector1 = mParticle.eCommerce.createProduct(
                    'Laser Projector',
                    'LP-1',
                    2999.99
                )

                lightTable1 = mParticle.eCommerce.createProduct(
                    'Light Table',
                    'LT-1',
                    5999.99
                )
                // !! Note: do not attempt to access the user object at this point
                // !! var user = window.mParticle.Identity.getCurrentUser();
                // !! Instead, access the user object via the mParticle.config.identityCallback option
            },
        );


        const identityCallback = function (result) {
            // console.log(result);
            if (result.isLoggedIn) {
                const login = document.querySelector('.login_screen');
                const main = document.querySelector('.main_screen');
                login.style.display = 'none';
                main.style.display = 'block';
            }
            result.getUser().setUserAttributes(result.getPreviousUser().getAllUserAttributes());

            // Create and send the alias request
            // var aliasRequest = mParticle.Identity.createAliasRequest(result.getPreviousUser(), result.getUser());
            // mParticle.Identity.aliasUsers(aliasRequest);
        };

        function loginUser() {
            const email = document.querySelector('.email');


            const login = document.querySelector('.login_screen');
            const main = document.querySelector('.main_screen');
            const user = mParticle.Identity.getCurrentUser();

            const idReq = {
                userIdentities: {
                    customerid: email.value, 
                    // customerid: "web_customer_id_3"
                    email: email.value
                }
            }

            window.mParticle.Identity.login(idReq, identityCallback)
            // login.style.display = 'none'; 
            // main.style.display  = 'block'; 

            // email.value = '';
            // name.value = ''; 
            // location.reload(); 
        }
        
        function modifyUser(){
            const email = document.querySelector('.email');


            const login = document.querySelector('.login_screen');
            const main = document.querySelector('.main_screen');
            const user = mParticle.Identity.getCurrentUser();

            const idReq = {
                userIdentities: {
                    // customerid: email.value, 
                    // customerid: "web_customer_id_2", 
                    email: "feed_email_3"
                }
            }

            window.mParticle.Identity.modify(idReq, identityCallback)
        }
        function logoutUser() {
            const login = document.querySelector('.login_screen');
            const main = document.querySelector('.main_screen');
            const email = document.querySelector('.email');
            window.mParticle.Identity.logout({}, identityCallback);
            // login.style.display = 'block'; 
            // main.style.display = 'none'; 
            email.value = '';
        }

        //Attributes section
        function updateAttributes() {
            const name = document.querySelector('.name');
            const drink = document.querySelector('.drink');
            const food = document.querySelector('.food');
            const user = mParticle.Identity.getCurrentUser();
            if (drink.value == "") {
                user.setUserAttribute('ua1', null);
            } else {
                user.setUserAttribute('ua1', drink.value);
            }

            // user.setUserAttribute('Food', food.value); 
            // user.setUserAttribute('Country', name.value); 
            name.value = '';
            drink.value = '';
            food.value = '';
        }

        //Custom Events Section
        function visitPage() {
            mParticle.logPageView(
                'Product Sale Page - 7661',
                {
                    "session_id": "abc-1234567"
                },
                { "Google.Page": window.location.pathname.toString() }
            )
            DY.API('spa', {
                context: {
                    type: 'PRODUCT',
                    data: ['product-sku']
                },
                url: window.location.pathname.toString(),
                countAsPageview: true
            });
        }

        function logMovieWatch() {
            mParticle.logEvent(
                'Video Watched',
                8,
                { 'category': 'Destination Intro', 'title': 'Paris', "session_id": "abc-1234567", }
            );
        }

        function logCustomEventClick() {
            mParticle.logEvent(
                'Custom Event - Other',
                mParticle.EventType.Other,
                { 'attribute1': 'Random', 'attribute2': 'Click_Testing', "attribute3": "abc-1234567" }
            )
        }

        // , "attribute7517": "abc-1234567" 

        function purchase(item, url) {
            let customFlags = null;
            let customAttributes = { sale: true, currency: 'USD', "session_id": "abc-1234567", };
            let date = new Date().toString()
            let transactionAttributes = {
                Id: "test",
                Revenue: 30,
                Tax: 30
            }
            if (item === 'couch1') {
                console.log(couch1);
                customAttributes.value = couch1.Price;
                transactionAttributes.Revenue += couch1.Price;
                mParticle.eCommerce.logProductAction(
                    mParticle.ProductActionType.Purchase,
                    [couch1],
                    customAttributes,
                    customFlags,
                    transactionAttributes
                );
            } else if (item === 'laserProjector1') {
                customAttributes.value = laserProjector1.Price;
                transactionAttributes.Revenue += laserProjector1.Price;
                mParticle.eCommerce.logProductAction(
                    mParticle.ProductActionType.Purchase,
                    [laserProjector1],
                    customAttributes,
                    customFlags,
                    transactionAttributes
                );
            } else if (item === 'lightTable1') {
                customAttributes.value = laserProjector1.Price;
                transactionAttributes.Revenue += lightTable1.Price;
                mParticle.eCommerce.logProductAction(
                    mParticle.ProductActionType.AddToCart,
                    [lightTable1],
                    customAttributes,
                    customFlags,
                    transactionAttributes
                );
            }

            // var callback = function () {
            //     if (typeof(url) != 'undefined') {
            //     window.location = url;
            //     }
            // };
            // gtag('event', 'conversion', {
            //     'send_to': 'AW-375902446/Fsq-CJCIw5ICEO6hn7MB',
            //     'value': 1.0,
            //     'currency': 'USD',
            //     'transaction_id': '',
            //     'event_callback': callback
            // });


        }

        function viewProduct(item) {
            let impression = {}
            if (item === 'couch1') {
                impression = mParticle.eCommerce.createImpression('Viewed Product List', couch1);
                mParticle.eCommerce.logImpression(impression);
            } else if (item === 'laserProjector1') {
                impression = mParticle.eCommerce.createImpression('Viewed Product List', laserProjector1);
                mParticle.eCommerce.logImpression(impression);
            } else if (item === 'lightTable1') {
                impression = mParticle.eCommerce.createImpression('Viewed Product List', lightTable1);
                mParticle.eCommerce.logImpression(impression);
            }
        }

        function gdprConsent(answer) {
            const current = mParticle.Identity.getCurrentUser();
            const location_collection_consent = mParticle.Consent.createGDPRConsent(
                answer,
                Date.now(),
                'location_based_agreement',
                'address_goes_here',
                'this would be the hardware ID'
            );

            const consentState = mParticle.Consent.createConsentState();
            consentState.addGDPRConsentState('location_collection', location_collection_consent)
            current.setConsentState(consentState);
        }

    </script>
</head>

<body>
    <h1>IDSync</h1>
    <div class="login_screen">
        <label>Email
            <input type="text" class='email'>
        </label>
        <button onclick="loginUser()">Log In</button>
        <button onclick="modifyUser()">Modify</button>
    </div>
    <div class="main_screen">
        <h2>Hello and Welcome!</h2>
        <button onclick="logoutUser()">Log Out</button>
        <h1>Change Things</h1>
        <label>Name
            <input type="text" class='name'>
        </label>
        <label>Favorite Food
            <input type="text" class='food'>
        </label>
        <label>Favorite Drink
            <input type="text" class='drink'>
        </label>
        <button onclick="updateAttributes()">Update All</button>
        <h1>Do Things</h1>
        <button onclick='logMovieWatch()'>Watch Movie</button>
        <button onclick='logCustomEventClick()'>Custom Event</button>
        <button onclick='visitPage()'>Visit Page</button>
        <h1>Buy Things</h1>
        <label>A Beautiful Couch</label>
        <button onclick="viewProduct('couch1')">View It</button>
        <button onclick="purchase('couch1')">Buy It</button>

        <label>A laser Projector</label>
        <button onclick="viewProduct('laserProjector1')">View It</button>
        <button onclick="purchase('laserProjector1')">Buy It</button>

        <label>A Light Table</label>
        <button onclick="viewProduct('lightTable1')">View It</button>
        <button onclick="purchase('lightTable1')">Buy It</button>

        <h2>Consent to Things</h2>
        <label>GDPR Consent
            <button onclick="gdprConsent(true)">Consent</button>
            <button onclick="gdprConsent(false)">Opt Out</button>
        </label>
    </div>
</body>

</html>